@let state = vm.state();

<main
  [class.p-landing--menu-collapsed]="state.menuCollapsed"
  class="p-landing"
  aria-labelledby="landing-title"
>
  <div class="p-landing__sr-live" aria-live="polite">
    {{ state.liveAnnouncement }}
  </div>

  <header class="p-landing__header">
    @if (state.menuCollapsed) {
      <button
        [attr.aria-expanded]="!state.menuCollapsed"
        (click)="onToggleMenu()"
        type="button"
        class="c-button c-button--ghost p-landing__menu-toggle"
        aria-controls="landing-menu"
      >
        {{ state.locale === 'en' ? 'Open navigation menu' : 'Abrir menú de navegación' }}
      </button>
    }
  </header>

  @if (!state.featureEnabled) {
    <section class="p-landing__fallback" role="status" aria-live="assertive">
      <h2 class="p-landing__fallback-title">
        {{
          state.locale === 'en'
            ? 'The new landing is not available yet'
            : 'La nueva landing todavía no está disponible'
        }}
      </h2>
      <p class="p-landing__fallback-message">
        {{
          state.locale === 'en'
            ? 'You are viewing the legacy experience. Ask your coordinator to enable ff_ui_landing_base when you are ready.'
            : 'Estás viendo la experiencia anterior. Solicita a tu coordinador activar ff_ui_landing_base cuando estéis listos.'
        }}
      </p>
    </section>
  } @else {
    @if (state.speechBanner) {
      <section class="p-landing__banner" role="alert" aria-live="assertive">
        <div class="p-landing__banner-content">
          <h2 class="p-landing__banner-title">{{ state.speechBanner.title }}</h2>
          <p class="p-landing__banner-message">{{ state.speechBanner.description }}</p>
        </div>
        <button
          (click)="onDismissBanner()"
          type="button"
          class="c-button c-button--ghost p-landing__banner-close"
        >
          {{ state.locale === 'en' ? 'Close message' : 'Cerrar mensaje' }}
        </button>
      </section>
    }

    <div class="p-landing__layout">
      <h1 id="landing-title" class="p-landing__title">Pictotalking</h1>

      <pic-landing-aside
        [sections]="state.sections"
        [locale]="state.locale"
        [menuCollapsed]="state.menuCollapsed"
        [activeSectionId]="state.activeSectionId"
        (sectionSelected)="onSelectSection($event)"
        (sidebarToggled)="onToggleMenu()"
      />

      <section class="p-landing__content" aria-live="polite">
        <h2 class="p-landing__content-title">
          {{ state.locale === 'en' ? 'Explore categories' : 'Explora categorías' }}
        </h2>

        @if (state.loading) {
          <div class="p-landing__skeleton-grid" aria-hidden="true">
            @for (skeleton of [1, 2, 3, 4, 5, 6, 7, 8]; track skeleton) {
              <div class="p-landing__skeleton-card"></div>
            }
          </div>
        } @else {
          @if (state.categories.length > 0) {
            <ul class="p-landing__categories" role="list">
              @for (category of state.categories; track category.id) {
                <li class="p-landing__categories-item">
                  <article
                    class="c-card p-landing__category-card"
                    [class.p-landing__category-card--expanded]="
                      expandedCategoryId() === category.id
                    "
                    [attr.aria-expanded]="expandedCategoryId() === category.id"
                    [attr.aria-label]="
                      state.locale === 'en'
                        ? 'Play ' + category.title
                        : 'Reproducir ' + category.title
                    "
                    (pic-accessible-event-trigger)="onCategoryActivate(category.id)"
                  >
                    <img
                      [ngSrc]="category.pictogramUrl"
                      [attr.alt]="category.imageAlt"
                      ngOptimizedImage
                      width="160"
                      height="160"
                      class="p-landing__category-image"
                    />
                    <div class="p-landing__category-body">
                      <h3 class="p-landing__category-title">{{ category.title }}</h3>
                    </div>
                  </article>
                </li>
              }
            </ul>
          } @else {
            <p class="p-landing__empty-state" role="status">
              {{
                state.locale === 'en'
                  ? 'There are no categories to show right now.'
                  : 'No hay categorías para mostrar en este momento.'
              }}
            </p>
          }
        }
      </section>
    </div>
  }
</main>
