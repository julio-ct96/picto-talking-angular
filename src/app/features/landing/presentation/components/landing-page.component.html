@let state = vm.state();

<main
  class="p-landing"
  [class.p-landing--menu-collapsed]="state.menuCollapsed"
  aria-labelledby="landing-title"
>
  <div class="p-landing__sr-live" aria-live="polite">
    {{ state.liveAnnouncement }}
  </div>

  <header class="p-landing__header">
    <h1 id="landing-title" class="p-landing__title">Pictotalking</h1>
    <p class="p-landing__intro">
      {{
        state.locale === 'en'
          ? 'Discover pictograms and voice feedback from the very first screen.'
          : 'Descubre pictogramas y voz de apoyo desde el primer momento.'
      }}
    </p>
    <button
      type="button"
      class="c-button c-button--ghost p-landing__menu-toggle"
      (click)="onToggleMenu()"
      [attr.aria-expanded]="!state.menuCollapsed"
      aria-controls="landing-menu"
    >
      {{
        state.locale === 'en'
          ? state.menuCollapsed
            ? 'Open navigation menu'
            : 'Collapse navigation menu'
          : state.menuCollapsed
            ? 'Abrir men√∫ de navegaci√≥n'
            : 'Colapsar men√∫ de navegaci√≥n'
      }}
    </button>
  </header>

  @if (!state.featureEnabled) {
    <section class="p-landing__fallback" role="status" aria-live="assertive">
      <h2 class="p-landing__fallback-title">
        {{
          state.locale === 'en'
            ? 'The new landing is not available yet'
            : 'La nueva landing todav√≠a no est√° disponible'
        }}
      </h2>
      <p class="p-landing__fallback-message">
        {{
          state.locale === 'en'
            ? 'You are viewing the legacy experience. Ask your coordinator to enable ff_ui_landing_base when you are ready.'
            : 'Est√°s viendo la experiencia anterior. Solicita a tu coordinador activar ff_ui_landing_base cuando est√©is listos.'
        }}
      </p>
    </section>
  } @else {
    @if (state.speechBanner) {
      <section class="p-landing__banner" role="alert" aria-live="assertive">
        <div class="p-landing__banner-content">
          <h2 class="p-landing__banner-title">{{ state.speechBanner.title }}</h2>
          <p class="p-landing__banner-message">{{ state.speechBanner.description }}</p>
        </div>
        <button
          type="button"
          class="c-button c-button--ghost p-landing__banner-close"
          (click)="onDismissBanner()"
        >
          {{ state.locale === 'en' ? 'Close message' : 'Cerrar mensaje' }}
        </button>
      </section>
    }

    <div class="p-landing__layout">
      <aside
        id="landing-menu"
        class="p-landing__menu"
        role="navigation"
        [class.p-landing__menu--collapsed]="state.menuCollapsed"
        [attr.aria-label]="
          state.locale === 'en' ? 'Landing sections' : 'Secciones de la landing'
        "
      >
        <h2 class="p-landing__menu-title">
          {{ state.locale === 'en' ? 'Sections' : 'Secciones' }}
        </h2>
        <ul class="p-landing__menu-list" role="list">
          @for (section of state.sections; track section.id) {
            <li class="p-landing__menu-item">
              <button
                type="button"
                class="c-button c-button--ghost p-landing__menu-button"
                [class.p-landing__menu-button--active]="
                  section.id === state.activeSectionId
                "
                (click)="onSelectSection(section.id)"
                [attr.aria-pressed]="section.id === state.activeSectionId"
                [attr.aria-describedby]="'section-hint-' + section.id"
              >
                <span class="p-landing__menu-label">{{ section.label }}</span>
              </button>
              <p id="{{ 'section-hint-' + section.id }}" class="p-landing__menu-hint">
                {{ section.hint }}
              </p>
            </li>
          }
        </ul>
      </aside>

      <section class="p-landing__content" aria-live="polite">
        <h2 class="p-landing__content-title">
          {{ state.locale === 'en' ? 'Explore categories' : 'Explora categor√≠as' }}
        </h2>

        @if (state.loading) {
          <div class="p-landing__skeleton-grid" aria-hidden="true">
            @for (skeleton of [1, 2, 3, 4, 5, 6, 7, 8]; track skeleton) {
              <div class="p-landing__skeleton-card"></div>
            }
          </div>
        } @else {
          @if (state.categories.length > 0) {
            <ul class="p-landing__categories" role="list">
              @for (category of state.categories; track category.id) {
                <li class="p-landing__categories-item">
                  <article class="c-card p-landing__category-card">
                    <img
                      ngOptimizedImage
                      [ngSrc]="category.pictogramUrl"
                      width="160"
                      height="160"
                      [attr.alt]="category.imageAlt"
                      class="p-landing__category-image"
                    />
                    <div class="p-landing__category-body">
                      <h3 class="p-landing__category-title">{{ category.title }}</h3>
                      <button
                        type="button"
                        class="c-button p-landing__category-action"
                        (click)="onCategoryActivate(category.id)"
                        [attr.aria-label]="
                          state.locale === 'en'
                            ? 'Play ' + category.title
                            : 'Reproducir ' + category.title
                        "
                      >
                        <span aria-hidden="true" class="p-landing__category-action-icon"
                          >üîä</span
                        >
                        <span class="p-landing__category-action-text">
                          {{ state.locale === 'en' ? 'Play' : 'Reproducir' }}
                        </span>
                      </button>
                    </div>
                  </article>
                </li>
              }
            </ul>
          } @else {
            <p class="p-landing__empty-state" role="status">
              {{
                state.locale === 'en'
                  ? 'There are no categories to show right now.'
                  : 'No hay categor√≠as para mostrar en este momento.'
              }}
            </p>
          }
        }
      </section>
    </div>
  }
</main>
